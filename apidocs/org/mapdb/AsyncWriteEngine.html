<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!--NewPage-->
<HTML>
<HEAD>
<!-- Generated by javadoc (build 1.6.0_45) on Tue Jul 15 16:21:34 EEST 2014 -->
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<TITLE>
AsyncWriteEngine (mapdb 1.0.5 API)
</TITLE>

<META NAME="date" CONTENT="2014-07-15">

<LINK REL ="stylesheet" TYPE="text/css" HREF="../../stylesheet.css" TITLE="Style">

<SCRIPT type="text/javascript">
function windowTitle()
{
    if (location.href.indexOf('is-external=true') == -1) {
        parent.document.title="AsyncWriteEngine (mapdb 1.0.5 API)";
    }
}
</SCRIPT>
<NOSCRIPT>
</NOSCRIPT>

</HEAD>

<BODY BGCOLOR="white" onload="windowTitle();">
<HR>


<!-- ========= START OF TOP NAVBAR ======= -->
<A NAME="navbar_top"><!-- --></A>
<A HREF="#skip-navbar_top" title="Skip navigation links"></A>
<TABLE BORDER="0" WIDTH="100%" CELLPADDING="1" CELLSPACING="0" SUMMARY="">
<TR>
<TD COLSPAN=2 BGCOLOR="#EEEEFF" CLASS="NavBarCell1">
<A NAME="navbar_top_firstrow"><!-- --></A>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="3" SUMMARY="">
  <TR ALIGN="center" VALIGN="top">
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../org/mapdb/package-summary.html"><FONT CLASS="NavBarFont1"><B>Package</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#FFFFFF" CLASS="NavBarCell1Rev"> &nbsp;<FONT CLASS="NavBarFont1Rev"><B>Class</B></FONT>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="class-use/AsyncWriteEngine.html"><FONT CLASS="NavBarFont1"><B>Use</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-tree.html"><FONT CLASS="NavBarFont1"><B>Tree</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../deprecated-list.html"><FONT CLASS="NavBarFont1"><B>Deprecated</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../index-all.html"><FONT CLASS="NavBarFont1"><B>Index</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../help-doc.html"><FONT CLASS="NavBarFont1"><B>Help</B></FONT></A>&nbsp;</TD>
  </TR>
</TABLE>
</TD>
<TD ALIGN="right" VALIGN="top" ROWSPAN=3><EM>
</EM>
</TD>
</TR>

<TR>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
&nbsp;PREV CLASS&nbsp;
&nbsp;<A HREF="../../org/mapdb/AsyncWriteEngine.WriterRunnable.html" title="class in org.mapdb"><B>NEXT CLASS</B></A></FONT></TD>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
  <A HREF="../../index.html?org/mapdb/AsyncWriteEngine.html" target="_top"><B>FRAMES</B></A>  &nbsp;
&nbsp;<A HREF="AsyncWriteEngine.html" target="_top"><B>NO FRAMES</B></A>  &nbsp;
&nbsp;<SCRIPT type="text/javascript">
  <!--
  if(window==top) {
    document.writeln('<A HREF="../../allclasses-noframe.html"><B>All Classes</B></A>');
  }
  //-->
</SCRIPT>
<NOSCRIPT>
  <A HREF="../../allclasses-noframe.html"><B>All Classes</B></A>
</NOSCRIPT>


</FONT></TD>
</TR>
<TR>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
  SUMMARY:&nbsp;<A HREF="#nested_class_summary">NESTED</A>&nbsp;|&nbsp;<A HREF="#field_summary">FIELD</A>&nbsp;|&nbsp;<A HREF="#constructor_summary">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_summary">METHOD</A></FONT></TD>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
DETAIL:&nbsp;<A HREF="#field_detail">FIELD</A>&nbsp;|&nbsp;<A HREF="#constructor_detail">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_detail">METHOD</A></FONT></TD>
</TR>
</TABLE>
<A NAME="skip-navbar_top"></A>
<!-- ========= END OF TOP NAVBAR ========= -->

<HR>
<!-- ======== START OF CLASS DATA ======== -->
<H2>
<FONT SIZE="-1">
org.mapdb</FONT>
<BR>
Class AsyncWriteEngine</H2>
<PRE>
<A HREF="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">java.lang.Object</A>
  <IMG SRC="../../resources/inherit.gif" ALT="extended by "><A HREF="../../org/mapdb/EngineWrapper.html" title="class in org.mapdb">org.mapdb.EngineWrapper</A>
      <IMG SRC="../../resources/inherit.gif" ALT="extended by "><B>org.mapdb.AsyncWriteEngine</B>
</PRE>
<DL>
<DT><B>All Implemented Interfaces:</B> <DD><A HREF="../../org/mapdb/Engine.html" title="interface in org.mapdb">Engine</A></DD>
</DL>
<HR>
<DL>
<DT><PRE>public class <B>AsyncWriteEngine</B><DT>extends <A HREF="../../org/mapdb/EngineWrapper.html" title="class in org.mapdb">EngineWrapper</A><DT>implements <A HREF="../../org/mapdb/Engine.html" title="interface in org.mapdb">Engine</A></DL>
</PRE>

<P>
<A HREF="../../org/mapdb/Engine.html" title="interface in org.mapdb"><CODE>Engine</CODE></A> wrapper which provides asynchronous serialization and asynchronous write.
 This class takes an object instance, passes it to background writer thread (using Write Queue)
 where it is serialized and written to disk. Async write does not affect commit durability,
 Write Queue is flushed into disk on each commit. Modified records are held in small instance cache,
 until they are written into disk.

 This feature is disabled by default and can be enabled by calling <A HREF="../../org/mapdb/DBMaker.html#asyncWriteEnable()"><CODE>DBMaker.asyncWriteEnable()</CODE></A>.
 Write Cache is flushed in regular intervals or when it becomes full. Flush interval is 100 ms by default and
 can be controlled by <A HREF="../../org/mapdb/DBMaker.html#asyncWriteFlushDelay(int)"><CODE>DBMaker.asyncWriteFlushDelay(int)</CODE></A>. Increasing this interval may improve performance
 in scenarios where frequently modified items should be cached, typically <A HREF="../../org/mapdb/BTreeMap.html" title="class in org.mapdb"><CODE>BTreeMap</CODE></A> import where keys
 are presorted.

 Asynchronous write does not affect commit durability. Write Queue is flushed during each commit, rollback and close call.
 Those method also block until all records are written.
 You may flush Write Queue manually by using <A HREF="../../org/mapdb/AsyncWriteEngine.html#clearCache()"><CODE>clearCache()</CODE></A>  method.
 There is global lock which prevents record being updated while commit is in progress.

 This wrapper starts one threads named `MapDB writer #N` (where N is static counter).
 Async Writer takes modified records from Write Queue and writes them into store.
 It also preallocates new recids, as finding empty `recids` takes time so small stash is pre-allocated.
 It runs as `daemon`, so it does not prevent JVM to exit.

 Asynchronous Writes have several advantages (especially for single threaded user). But there are two things
 user should be aware of:

  * Because data are serialized on back-ground thread, they need to be thread safe or better immutable.
    When you insert record into MapDB and modify it latter, this modification may happen before item
    was serialized and you may not be sure what version was persisted

  * Inter-thread communication has some overhead.
    There is also only single Writer Thread, which may create  single bottle-neck.
    This usually not issue for
    single or two threads, but in multi-threaded environment it may decrease performance.
    So in truly concurrent environments with many updates (network servers, parallel computing )
    you should keep Asynchronous Writes disabled.
<P>

<P>
<DL>
<DT><B>Author:</B></DT>
  <DD>Jan Kotek</DD>
<DT><B>See Also:</B><DD><A HREF="../../org/mapdb/Engine.html" title="interface in org.mapdb"><CODE>Engine</CODE></A>, 
<A HREF="../../org/mapdb/EngineWrapper.html" title="class in org.mapdb"><CODE>EngineWrapper</CODE></A></DL>
<HR>

<P>
<!-- ======== NESTED CLASS SUMMARY ======== -->

<A NAME="nested_class_summary"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2">
<B>Nested Class Summary</B></FONT></TH>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>protected static&nbsp;class</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../org/mapdb/AsyncWriteEngine.WriterRunnable.html" title="class in org.mapdb">AsyncWriteEngine.WriterRunnable</A></B></CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</TD>
</TR>
</TABLE>
&nbsp;<A NAME="nested_classes_inherited_from_class_org.mapdb.EngineWrapper"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#EEEEFF" CLASS="TableSubHeadingColor">
<TH ALIGN="left"><B>Nested classes/interfaces inherited from class org.mapdb.<A HREF="../../org/mapdb/EngineWrapper.html" title="class in org.mapdb">EngineWrapper</A></B></TH>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD><CODE><A HREF="../../org/mapdb/EngineWrapper.CloseOnJVMShutdown.html" title="class in org.mapdb">EngineWrapper.CloseOnJVMShutdown</A>, <A HREF="../../org/mapdb/EngineWrapper.ImmutabilityCheckEngine.html" title="class in org.mapdb">EngineWrapper.ImmutabilityCheckEngine</A>, <A HREF="../../org/mapdb/EngineWrapper.ReadOnlyEngine.html" title="class in org.mapdb">EngineWrapper.ReadOnlyEngine</A>, <A HREF="../../org/mapdb/EngineWrapper.SerializerCheckEngineWrapper.html" title="class in org.mapdb">EngineWrapper.SerializerCheckEngineWrapper</A>, <A HREF="../../org/mapdb/EngineWrapper.SynchronizedEngineWrapper.html" title="class in org.mapdb">EngineWrapper.SynchronizedEngineWrapper</A></CODE></TD>
</TR>
</TABLE>
&nbsp;
<!-- =========== FIELD SUMMARY =========== -->

<A NAME="field_summary"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2">
<B>Field Summary</B></FONT></TH>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>protected &nbsp;<A HREF="http://java.sun.com/javase/6/docs/api/java/util/concurrent/atomic/AtomicReference.html?is-external=true" title="class or interface in java.util.concurrent.atomic">AtomicReference</A>&lt;<A HREF="http://java.sun.com/javase/6/docs/api/java/util/concurrent/CountDownLatch.html?is-external=true" title="class or interface in java.util.concurrent">CountDownLatch</A>&gt;</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../org/mapdb/AsyncWriteEngine.html#action">action</A></B></CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>protected &nbsp;<A HREF="http://java.sun.com/javase/6/docs/api/java/util/concurrent/CountDownLatch.html?is-external=true" title="class or interface in java.util.concurrent">CountDownLatch</A></CODE></FONT></TD>
<TD><CODE><B><A HREF="../../org/mapdb/AsyncWriteEngine.html#activeThreadsCount">activeThreadsCount</A></B></CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;number of active threads running, used to await thread termination on close</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>protected &nbsp;int</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../org/mapdb/AsyncWriteEngine.html#asyncFlushDelay">asyncFlushDelay</A></B></CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;flush Write Queue every N milliseconds</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>protected &nbsp;boolean</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../org/mapdb/AsyncWriteEngine.html#closeInProgress">closeInProgress</A></B></CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;indicates that `close()` was called and background threads are being terminated</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>protected &nbsp;<A HREF="http://java.sun.com/javase/6/docs/api/java/util/concurrent/locks/ReentrantReadWriteLock.html?is-external=true" title="class or interface in java.util.concurrent.locks">ReentrantReadWriteLock</A></CODE></FONT></TD>
<TD><CODE><B><A HREF="../../org/mapdb/AsyncWriteEngine.html#commitLock">commitLock</A></B></CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Each insert to Write Queue must hold read lock.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>protected &nbsp;int</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../org/mapdb/AsyncWriteEngine.html#maxSize">maxSize</A></B></CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>protected &nbsp;<A HREF="http://java.sun.com/javase/6/docs/api/java/util/concurrent/atomic/AtomicInteger.html?is-external=true" title="class or interface in java.util.concurrent.atomic">AtomicInteger</A></CODE></FONT></TD>
<TD><CODE><B><A HREF="../../org/mapdb/AsyncWriteEngine.html#size">size</A></B></CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>protected static&nbsp;<A HREF="http://java.sun.com/javase/6/docs/api/java/util/concurrent/atomic/AtomicLong.html?is-external=true" title="class or interface in java.util.concurrent.atomic">AtomicLong</A></CODE></FONT></TD>
<TD><CODE><B><A HREF="../../org/mapdb/AsyncWriteEngine.html#threadCounter">threadCounter</A></B></CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ensures thread name is followed by number</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>protected &nbsp;<A HREF="http://java.sun.com/javase/6/docs/api/java/lang/Throwable.html?is-external=true" title="class or interface in java.lang">Throwable</A></CODE></FONT></TD>
<TD><CODE><B><A HREF="../../org/mapdb/AsyncWriteEngine.html#threadFailedException">threadFailedException</A></B></CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;If background thread fails with exception, it is stored here, and rethrown to all callers.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>protected static&nbsp;<A HREF="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</A></CODE></FONT></TD>
<TD><CODE><B><A HREF="../../org/mapdb/AsyncWriteEngine.html#TOMBSTONE">TOMBSTONE</A></B></CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;used to signal that object was deleted</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>protected &nbsp;<A HREF="../../org/mapdb/LongConcurrentHashMap.html" title="class in org.mapdb">LongConcurrentHashMap</A>&lt;<A HREF="../../org/mapdb/Fun.Tuple2.html" title="class in org.mapdb">Fun.Tuple2</A>&lt;<A HREF="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</A>,<A HREF="../../org/mapdb/Serializer.html" title="interface in org.mapdb">Serializer</A>&gt;&gt;</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../org/mapdb/AsyncWriteEngine.html#writeCache">writeCache</A></B></CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Associates `recid` from Write Queue with record data and serializer.</TD>
</TR>
</TABLE>
&nbsp;<A NAME="fields_inherited_from_class_org.mapdb.EngineWrapper"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#EEEEFF" CLASS="TableSubHeadingColor">
<TH ALIGN="left"><B>Fields inherited from class org.mapdb.<A HREF="../../org/mapdb/EngineWrapper.html" title="class in org.mapdb">EngineWrapper</A></B></TH>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD><CODE><A HREF="../../org/mapdb/EngineWrapper.html#CLOSED">CLOSED</A></CODE></TD>
</TR>
</TABLE>
&nbsp;<A NAME="fields_inherited_from_class_org.mapdb.Engine"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#EEEEFF" CLASS="TableSubHeadingColor">
<TH ALIGN="left"><B>Fields inherited from interface org.mapdb.<A HREF="../../org/mapdb/Engine.html" title="interface in org.mapdb">Engine</A></B></TH>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD><CODE><A HREF="../../org/mapdb/Engine.html#CATALOG_RECID">CATALOG_RECID</A>, <A HREF="../../org/mapdb/Engine.html#CHECK_RECORD">CHECK_RECORD</A>, <A HREF="../../org/mapdb/Engine.html#CLASS_INFO_RECID">CLASS_INFO_RECID</A>, <A HREF="../../org/mapdb/Engine.html#LAST_RESERVED_RECID">LAST_RESERVED_RECID</A></CODE></TD>
</TR>
</TABLE>
&nbsp;
<!-- ======== CONSTRUCTOR SUMMARY ======== -->

<A NAME="constructor_summary"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2">
<B>Constructor Summary</B></FONT></TH>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD><CODE><B><A HREF="../../org/mapdb/AsyncWriteEngine.html#AsyncWriteEngine(org.mapdb.Engine)">AsyncWriteEngine</A></B>(<A HREF="../../org/mapdb/Engine.html" title="interface in org.mapdb">Engine</A>&nbsp;engine)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD><CODE><B><A HREF="../../org/mapdb/AsyncWriteEngine.html#AsyncWriteEngine(org.mapdb.Engine, int, int, java.util.concurrent.Executor)">AsyncWriteEngine</A></B>(<A HREF="../../org/mapdb/Engine.html" title="interface in org.mapdb">Engine</A>&nbsp;engine,
                 int&nbsp;_asyncFlushDelay,
                 int&nbsp;queueSize,
                 <A HREF="http://java.sun.com/javase/6/docs/api/java/util/concurrent/Executor.html?is-external=true" title="class or interface in java.util.concurrent">Executor</A>&nbsp;executor)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Construct new class and starts background threads.</TD>
</TR>
</TABLE>
&nbsp;
<!-- ========== METHOD SUMMARY =========== -->

<A NAME="method_summary"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2">
<B>Method Summary</B></FONT></TH>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>protected &nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../org/mapdb/AsyncWriteEngine.html#checkState()">checkState</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;checks that background threads are ready and throws exception if not</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../org/mapdb/AsyncWriteEngine.html#clearCache()">clearCache</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;clears any underlying cache</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../org/mapdb/AsyncWriteEngine.html#close()">close</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Close store/cache.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../org/mapdb/AsyncWriteEngine.html#commit()">commit</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Makes all changes made since the previous commit/rollback permanent.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../org/mapdb/AsyncWriteEngine.html#compact()">compact</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

 This method blocks all put/update/delete operations until it finishes (via global ReadWrite Commit Lock).</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" SUMMARY="">
<TR ALIGN="right" VALIGN="">
<TD NOWRAP><FONT SIZE="-1">
<CODE>&lt;A&gt; boolean</CODE></FONT></TD>
</TR>
</TABLE>
</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../org/mapdb/AsyncWriteEngine.html#compareAndSwap(long, A, A, org.mapdb.Serializer)">compareAndSwap</A></B>(long&nbsp;recid,
               A&nbsp;expectedOldValue,
               A&nbsp;newValue,
               <A HREF="../../org/mapdb/Serializer.html" title="interface in org.mapdb">Serializer</A>&lt;A&gt;&nbsp;serializer)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Updates existing record in atomic <a href="http://en.wikipedia.org/wiki/Compare-and-swap">(Compare And Swap)</a> manner.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" SUMMARY="">
<TR ALIGN="right" VALIGN="">
<TD NOWRAP><FONT SIZE="-1">
<CODE>&lt;A&gt; void</CODE></FONT></TD>
</TR>
</TABLE>
</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../org/mapdb/AsyncWriteEngine.html#delete(long, org.mapdb.Serializer)">delete</A></B>(long&nbsp;recid,
       <A HREF="../../org/mapdb/Serializer.html" title="interface in org.mapdb">Serializer</A>&lt;A&gt;&nbsp;serializer)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Remove existing record from store/cache

 <p/>
 Recid must be a number returned by 'put' method.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" SUMMARY="">
<TR ALIGN="right" VALIGN="">
<TD NOWRAP><FONT SIZE="-1">
<CODE>&lt;A&gt; A</CODE></FONT></TD>
</TR>
</TABLE>
</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../org/mapdb/AsyncWriteEngine.html#get(long, org.mapdb.Serializer)">get</A></B>(long&nbsp;recid,
    <A HREF="../../org/mapdb/Serializer.html" title="interface in org.mapdb">Serializer</A>&lt;A&gt;&nbsp;serializer)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Get existing record.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" SUMMARY="">
<TR ALIGN="right" VALIGN="">
<TD NOWRAP><FONT SIZE="-1">
<CODE>&lt;A&gt; long</CODE></FONT></TD>
</TR>
</TABLE>
</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../org/mapdb/AsyncWriteEngine.html#put(A, org.mapdb.Serializer)">put</A></B>(A&nbsp;value,
    <A HREF="../../org/mapdb/Serializer.html" title="interface in org.mapdb">Serializer</A>&lt;A&gt;&nbsp;serializer)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Insert new record.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>&nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../org/mapdb/AsyncWriteEngine.html#rollback()">rollback</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Undoes all changes made in the current transaction.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>protected &nbsp;boolean</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../org/mapdb/AsyncWriteEngine.html#runWriter()">runWriter</A></B>()</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;runs on background thread.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>protected &nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../org/mapdb/AsyncWriteEngine.html#startThreads(java.util.concurrent.Executor)">startThreads</A></B>(<A HREF="http://java.sun.com/javase/6/docs/api/java/util/concurrent/Executor.html?is-external=true" title="class or interface in java.util.concurrent">Executor</A>&nbsp;executor)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Starts background threads.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="0" SUMMARY="">
<TR ALIGN="right" VALIGN="">
<TD NOWRAP><FONT SIZE="-1">
<CODE>&lt;A&gt; void</CODE></FONT></TD>
</TR>
</TABLE>
</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../org/mapdb/AsyncWriteEngine.html#update(long, A, org.mapdb.Serializer)">update</A></B>(long&nbsp;recid,
       A&nbsp;value,
       <A HREF="../../org/mapdb/Serializer.html" title="interface in org.mapdb">Serializer</A>&lt;A&gt;&nbsp;serializer)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Update existing record with new value.</TD>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
<CODE>protected &nbsp;void</CODE></FONT></TD>
<TD><CODE><B><A HREF="../../org/mapdb/AsyncWriteEngine.html#waitForAction(int)">waitForAction</A></B>(int&nbsp;actionNumber)</CODE>

<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</TD>
</TR>
</TABLE>
&nbsp;<A NAME="methods_inherited_from_class_org.mapdb.EngineWrapper"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#EEEEFF" CLASS="TableSubHeadingColor">
<TH ALIGN="left"><B>Methods inherited from class org.mapdb.<A HREF="../../org/mapdb/EngineWrapper.html" title="class in org.mapdb">EngineWrapper</A></B></TH>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD><CODE><A HREF="../../org/mapdb/EngineWrapper.html#canRollback()">canRollback</A>, <A HREF="../../org/mapdb/EngineWrapper.html#canSnapshot()">canSnapshot</A>, <A HREF="../../org/mapdb/EngineWrapper.html#checkClosed(V)">checkClosed</A>, <A HREF="../../org/mapdb/EngineWrapper.html#closeListenerRegister(java.lang.Runnable)">closeListenerRegister</A>, <A HREF="../../org/mapdb/EngineWrapper.html#closeListenerUnregister(java.lang.Runnable)">closeListenerUnregister</A>, <A HREF="../../org/mapdb/EngineWrapper.html#getSerializerPojo()">getSerializerPojo</A>, <A HREF="../../org/mapdb/EngineWrapper.html#getWrappedEngine()">getWrappedEngine</A>, <A HREF="../../org/mapdb/EngineWrapper.html#isClosed()">isClosed</A>, <A HREF="../../org/mapdb/EngineWrapper.html#isReadOnly()">isReadOnly</A>, <A HREF="../../org/mapdb/EngineWrapper.html#preallocate()">preallocate</A>, <A HREF="../../org/mapdb/EngineWrapper.html#preallocate(long[])">preallocate</A>, <A HREF="../../org/mapdb/EngineWrapper.html#snapshot()">snapshot</A></CODE></TD>
</TR>
</TABLE>
&nbsp;<A NAME="methods_inherited_from_class_java.lang.Object"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#EEEEFF" CLASS="TableSubHeadingColor">
<TH ALIGN="left"><B>Methods inherited from class java.lang.<A HREF="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</A></B></TH>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD><CODE><A HREF="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true#clone()" title="class or interface in java.lang">clone</A>, <A HREF="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true#equals(java.lang.Object)" title="class or interface in java.lang">equals</A>, <A HREF="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true#finalize()" title="class or interface in java.lang">finalize</A>, <A HREF="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true#getClass()" title="class or interface in java.lang">getClass</A>, <A HREF="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true#hashCode()" title="class or interface in java.lang">hashCode</A>, <A HREF="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true#notify()" title="class or interface in java.lang">notify</A>, <A HREF="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true#notifyAll()" title="class or interface in java.lang">notifyAll</A>, <A HREF="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true#toString()" title="class or interface in java.lang">toString</A>, <A HREF="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true#wait()" title="class or interface in java.lang">wait</A>, <A HREF="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true#wait(long)" title="class or interface in java.lang">wait</A>, <A HREF="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true#wait(long, int)" title="class or interface in java.lang">wait</A></CODE></TD>
</TR>
</TABLE>
&nbsp;<A NAME="methods_inherited_from_class_org.mapdb.Engine"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#EEEEFF" CLASS="TableSubHeadingColor">
<TH ALIGN="left"><B>Methods inherited from interface org.mapdb.<A HREF="../../org/mapdb/Engine.html" title="interface in org.mapdb">Engine</A></B></TH>
</TR>
<TR BGCOLOR="white" CLASS="TableRowColor">
<TD><CODE><A HREF="../../org/mapdb/Engine.html#canRollback()">canRollback</A>, <A HREF="../../org/mapdb/Engine.html#canSnapshot()">canSnapshot</A>, <A HREF="../../org/mapdb/Engine.html#closeListenerRegister(java.lang.Runnable)">closeListenerRegister</A>, <A HREF="../../org/mapdb/Engine.html#closeListenerUnregister(java.lang.Runnable)">closeListenerUnregister</A>, <A HREF="../../org/mapdb/Engine.html#getSerializerPojo()">getSerializerPojo</A>, <A HREF="../../org/mapdb/Engine.html#isClosed()">isClosed</A>, <A HREF="../../org/mapdb/Engine.html#isReadOnly()">isReadOnly</A>, <A HREF="../../org/mapdb/Engine.html#preallocate()">preallocate</A>, <A HREF="../../org/mapdb/Engine.html#preallocate(long[])">preallocate</A>, <A HREF="../../org/mapdb/Engine.html#snapshot()">snapshot</A></CODE></TD>
</TR>
</TABLE>
&nbsp;
<P>

<!-- ============ FIELD DETAIL =========== -->

<A NAME="field_detail"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="1"><FONT SIZE="+2">
<B>Field Detail</B></FONT></TH>
</TR>
</TABLE>

<A NAME="threadCounter"><!-- --></A><H3>
threadCounter</H3>
<PRE>
protected static final <A HREF="http://java.sun.com/javase/6/docs/api/java/util/concurrent/atomic/AtomicLong.html?is-external=true" title="class or interface in java.util.concurrent.atomic">AtomicLong</A> <B>threadCounter</B></PRE>
<DL>
<DD>ensures thread name is followed by number
<P>
<DL>
</DL>
</DL>
<HR>

<A NAME="TOMBSTONE"><!-- --></A><H3>
TOMBSTONE</H3>
<PRE>
protected static final <A HREF="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</A> <B>TOMBSTONE</B></PRE>
<DL>
<DD>used to signal that object was deleted
<P>
<DL>
</DL>
</DL>
<HR>

<A NAME="maxSize"><!-- --></A><H3>
maxSize</H3>
<PRE>
protected final int <B>maxSize</B></PRE>
<DL>
<DL>
</DL>
</DL>
<HR>

<A NAME="size"><!-- --></A><H3>
size</H3>
<PRE>
protected final <A HREF="http://java.sun.com/javase/6/docs/api/java/util/concurrent/atomic/AtomicInteger.html?is-external=true" title="class or interface in java.util.concurrent.atomic">AtomicInteger</A> <B>size</B></PRE>
<DL>
<DL>
</DL>
</DL>
<HR>

<A NAME="writeCache"><!-- --></A><H3>
writeCache</H3>
<PRE>
protected final <A HREF="../../org/mapdb/LongConcurrentHashMap.html" title="class in org.mapdb">LongConcurrentHashMap</A>&lt;<A HREF="../../org/mapdb/Fun.Tuple2.html" title="class in org.mapdb">Fun.Tuple2</A>&lt;<A HREF="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</A>,<A HREF="../../org/mapdb/Serializer.html" title="interface in org.mapdb">Serializer</A>&gt;&gt; <B>writeCache</B></PRE>
<DL>
<DD>Associates `recid` from Write Queue with record data and serializer.
<P>
<DL>
</DL>
</DL>
<HR>

<A NAME="commitLock"><!-- --></A><H3>
commitLock</H3>
<PRE>
protected final <A HREF="http://java.sun.com/javase/6/docs/api/java/util/concurrent/locks/ReentrantReadWriteLock.html?is-external=true" title="class or interface in java.util.concurrent.locks">ReentrantReadWriteLock</A> <B>commitLock</B></PRE>
<DL>
<DD>Each insert to Write Queue must hold read lock.
  Commit, rollback and close operations must hold write lock
<P>
<DL>
</DL>
</DL>
<HR>

<A NAME="activeThreadsCount"><!-- --></A><H3>
activeThreadsCount</H3>
<PRE>
protected final <A HREF="http://java.sun.com/javase/6/docs/api/java/util/concurrent/CountDownLatch.html?is-external=true" title="class or interface in java.util.concurrent">CountDownLatch</A> <B>activeThreadsCount</B></PRE>
<DL>
<DD>number of active threads running, used to await thread termination on close
<P>
<DL>
</DL>
</DL>
<HR>

<A NAME="threadFailedException"><!-- --></A><H3>
threadFailedException</H3>
<PRE>
protected volatile <A HREF="http://java.sun.com/javase/6/docs/api/java/lang/Throwable.html?is-external=true" title="class or interface in java.lang">Throwable</A> <B>threadFailedException</B></PRE>
<DL>
<DD>If background thread fails with exception, it is stored here, and rethrown to all callers.
<P>
<DL>
</DL>
</DL>
<HR>

<A NAME="closeInProgress"><!-- --></A><H3>
closeInProgress</H3>
<PRE>
protected volatile boolean <B>closeInProgress</B></PRE>
<DL>
<DD>indicates that `close()` was called and background threads are being terminated
<P>
<DL>
</DL>
</DL>
<HR>

<A NAME="asyncFlushDelay"><!-- --></A><H3>
asyncFlushDelay</H3>
<PRE>
protected final int <B>asyncFlushDelay</B></PRE>
<DL>
<DD>flush Write Queue every N milliseconds
<P>
<DL>
</DL>
</DL>
<HR>

<A NAME="action"><!-- --></A><H3>
action</H3>
<PRE>
protected final <A HREF="http://java.sun.com/javase/6/docs/api/java/util/concurrent/atomic/AtomicReference.html?is-external=true" title="class or interface in java.util.concurrent.atomic">AtomicReference</A>&lt;<A HREF="http://java.sun.com/javase/6/docs/api/java/util/concurrent/CountDownLatch.html?is-external=true" title="class or interface in java.util.concurrent">CountDownLatch</A>&gt; <B>action</B></PRE>
<DL>
<DL>
</DL>
</DL>

<!-- ========= CONSTRUCTOR DETAIL ======== -->

<A NAME="constructor_detail"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="1"><FONT SIZE="+2">
<B>Constructor Detail</B></FONT></TH>
</TR>
</TABLE>

<A NAME="AsyncWriteEngine(org.mapdb.Engine, int, int, java.util.concurrent.Executor)"><!-- --></A><H3>
AsyncWriteEngine</H3>
<PRE>
public <B>AsyncWriteEngine</B>(<A HREF="../../org/mapdb/Engine.html" title="interface in org.mapdb">Engine</A>&nbsp;engine,
                        int&nbsp;_asyncFlushDelay,
                        int&nbsp;queueSize,
                        <A HREF="http://java.sun.com/javase/6/docs/api/java/util/concurrent/Executor.html?is-external=true" title="class or interface in java.util.concurrent">Executor</A>&nbsp;executor)</PRE>
<DL>
<DD>Construct new class and starts background threads.
 User may provide executor in which background tasks will be executed,
 otherwise MapDB starts two daemon threads.
<P>
<DL>
<DT><B>Parameters:</B><DD><CODE>engine</CODE> - which stores data.<DD><CODE>_asyncFlushDelay</CODE> - flush Write Queue every N milliseconds<DD><CODE>executor</CODE> - optional executor to run tasks. If null daemon threads will be created</DL>
</DL>
<HR>

<A NAME="AsyncWriteEngine(org.mapdb.Engine)"><!-- --></A><H3>
AsyncWriteEngine</H3>
<PRE>
public <B>AsyncWriteEngine</B>(<A HREF="../../org/mapdb/Engine.html" title="interface in org.mapdb">Engine</A>&nbsp;engine)</PRE>
<DL>
</DL>

<!-- ============ METHOD DETAIL ========== -->

<A NAME="method_detail"><!-- --></A>
<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
<TH ALIGN="left" COLSPAN="1"><FONT SIZE="+2">
<B>Method Detail</B></FONT></TH>
</TR>
</TABLE>

<A NAME="startThreads(java.util.concurrent.Executor)"><!-- --></A><H3>
startThreads</H3>
<PRE>
protected void <B>startThreads</B>(<A HREF="http://java.sun.com/javase/6/docs/api/java/util/concurrent/Executor.html?is-external=true" title="class or interface in java.util.concurrent">Executor</A>&nbsp;executor)</PRE>
<DL>
<DD>Starts background threads.
 You may override this if you wish to start thread different way
<P>
<DD><DL>
</DL>
</DD>
<DD><DL>
<DT><B>Parameters:</B><DD><CODE>executor</CODE> - optional executor to run tasks, if null deamon threads will be created</DL>
</DD>
</DL>
<HR>

<A NAME="runWriter()"><!-- --></A><H3>
runWriter</H3>
<PRE>
protected boolean <B>runWriter</B>()
                     throws <A HREF="http://java.sun.com/javase/6/docs/api/java/lang/InterruptedException.html?is-external=true" title="class or interface in java.lang">InterruptedException</A></PRE>
<DL>
<DD>runs on background thread. Takes records from Write Queue, serializes and writes them.
<P>
<DD><DL>
</DL>
</DD>
<DD><DL>

<DT><B>Throws:</B>
<DD><CODE><A HREF="http://java.sun.com/javase/6/docs/api/java/lang/InterruptedException.html?is-external=true" title="class or interface in java.lang">InterruptedException</A></CODE></DL>
</DD>
</DL>
<HR>

<A NAME="checkState()"><!-- --></A><H3>
checkState</H3>
<PRE>
protected void <B>checkState</B>()</PRE>
<DL>
<DD>checks that background threads are ready and throws exception if not
<P>
<DD><DL>
</DL>
</DD>
<DD><DL>
</DL>
</DD>
</DL>
<HR>

<A NAME="put(java.lang.Object,org.mapdb.Serializer)"><!-- --></A><A NAME="put(A, org.mapdb.Serializer)"><!-- --></A><H3>
put</H3>
<PRE>
public &lt;A&gt; long <B>put</B>(A&nbsp;value,
                    <A HREF="../../org/mapdb/Serializer.html" title="interface in org.mapdb">Serializer</A>&lt;A&gt;&nbsp;serializer)</PRE>
<DL>
<DD>Insert new record.

 Recids are managed by underlying Engine. Finding free or allocating new recids
 may take some time, so for this reason recids are preallocated by Writer Thread
 and stored in queue. This method just takes preallocated recid from queue with minimal
 delay.

 Newly inserted records are not written synchronously, but forwarded to background Writer Thread via queue.

 ![async-put](async-put.png)
<P>
<DD><DL>
<DT><B>Specified by:</B><DD><CODE><A HREF="../../org/mapdb/Engine.html#put(A, org.mapdb.Serializer)">put</A></CODE> in interface <CODE><A HREF="../../org/mapdb/Engine.html" title="interface in org.mapdb">Engine</A></CODE><DT><B>Overrides:</B><DD><CODE><A HREF="../../org/mapdb/EngineWrapper.html#put(A, org.mapdb.Serializer)">put</A></CODE> in class <CODE><A HREF="../../org/mapdb/EngineWrapper.html" title="class in org.mapdb">EngineWrapper</A></CODE></DL>
</DD>
<DD><DL>
<DT><B>Parameters:</B><DD><CODE>value</CODE> - records to be added<DD><CODE>serializer</CODE> - used to convert record into/from binary form
<DT><B>Returns:</B><DD>recid (record identifier) under which record is stored.</DL>
</DD>
</DL>
<HR>

<A NAME="get(long, org.mapdb.Serializer)"><!-- --></A><H3>
get</H3>
<PRE>
public &lt;A&gt; A <B>get</B>(long&nbsp;recid,
                 <A HREF="../../org/mapdb/Serializer.html" title="interface in org.mapdb">Serializer</A>&lt;A&gt;&nbsp;serializer)</PRE>
<DL>
<DD>Get existing record.
 <p/>
 Recid must be a number returned by 'put' method.
 Behaviour for invalid recid (random number or already deleted record)
 is not defined, typically it returns null or throws 'EndOfFileException'

 This method first looks up into Write Cache if record is not currently being written.
 If not it continues as usually
<P>
<DD><DL>
<DT><B>Specified by:</B><DD><CODE><A HREF="../../org/mapdb/Engine.html#get(long, org.mapdb.Serializer)">get</A></CODE> in interface <CODE><A HREF="../../org/mapdb/Engine.html" title="interface in org.mapdb">Engine</A></CODE><DT><B>Overrides:</B><DD><CODE><A HREF="../../org/mapdb/EngineWrapper.html#get(long, org.mapdb.Serializer)">get</A></CODE> in class <CODE><A HREF="../../org/mapdb/EngineWrapper.html" title="class in org.mapdb">EngineWrapper</A></CODE></DL>
</DD>
<DD><DL>
<DT><B>Parameters:</B><DD><CODE>recid</CODE> - (record identifier) under which record was persisted<DD><CODE>serializer</CODE> - used to deserialize record from binary form
<DT><B>Returns:</B><DD>record matching given recid, or null if record is not found under given recid.</DL>
</DD>
</DL>
<HR>

<A NAME="update(long,java.lang.Object,org.mapdb.Serializer)"><!-- --></A><A NAME="update(long, A, org.mapdb.Serializer)"><!-- --></A><H3>
update</H3>
<PRE>
public &lt;A&gt; void <B>update</B>(long&nbsp;recid,
                       A&nbsp;value,
                       <A HREF="../../org/mapdb/Serializer.html" title="interface in org.mapdb">Serializer</A>&lt;A&gt;&nbsp;serializer)</PRE>
<DL>
<DD>Update existing record with new value.
 <p/>
 Recid must be a number returned by 'put' method.
 Behaviour for invalid recid (random number or already deleted record)
 is not defined, typically it throws 'EndOfFileException',
 but it may also corrupt store.

 This methods forwards record into Writer Thread and returns asynchronously.

 ![async-update](async-update.png)
<P>
<DD><DL>
<DT><B>Specified by:</B><DD><CODE><A HREF="../../org/mapdb/Engine.html#update(long, A, org.mapdb.Serializer)">update</A></CODE> in interface <CODE><A HREF="../../org/mapdb/Engine.html" title="interface in org.mapdb">Engine</A></CODE><DT><B>Overrides:</B><DD><CODE><A HREF="../../org/mapdb/EngineWrapper.html#update(long, A, org.mapdb.Serializer)">update</A></CODE> in class <CODE><A HREF="../../org/mapdb/EngineWrapper.html" title="class in org.mapdb">EngineWrapper</A></CODE></DL>
</DD>
<DD><DL>
<DT><B>Parameters:</B><DD><CODE>recid</CODE> - (record identifier) under which record was persisted.<DD><CODE>value</CODE> - new record value to be stored<DD><CODE>serializer</CODE> - used to serialize record into binary form</DL>
</DD>
</DL>
<HR>

<A NAME="compareAndSwap(long,java.lang.Object,java.lang.Object,org.mapdb.Serializer)"><!-- --></A><A NAME="compareAndSwap(long, A, A, org.mapdb.Serializer)"><!-- --></A><H3>
compareAndSwap</H3>
<PRE>
public &lt;A&gt; boolean <B>compareAndSwap</B>(long&nbsp;recid,
                                  A&nbsp;expectedOldValue,
                                  A&nbsp;newValue,
                                  <A HREF="../../org/mapdb/Serializer.html" title="interface in org.mapdb">Serializer</A>&lt;A&gt;&nbsp;serializer)</PRE>
<DL>
<DD>Updates existing record in atomic <a href="http://en.wikipedia.org/wiki/Compare-and-swap">(Compare And Swap)</a> manner.
 Value is modified only if old value matches expected value. There are three ways to match values, MapDB may use any of them:
 <ol>
    <li>Equality check <code>oldValue==expectedOldValue</code> when old value is found in instance cache</li>
    <li>Deserializing <code>oldValue</code> using <code>serializer</code> and checking <code>oldValue.equals(expectedOldValue)</code></li>
    <li>Serializing <code>expectedOldValue</code> using <code>serializer </code> and comparing binary array with already serialized <code>oldValue</code>
 </ol>
 <p/>
 Recid must be a number returned by 'put' method.
 Behaviour for invalid recid (random number or already deleted record)
 is not defined, typically it throws 'EndOfFileException',
 but it may also corrupt store.

 This method first looks up Write Cache if record is not currently being written.
 Successful modifications are forwarded to Write Thread and method returns asynchronously.
 Asynchronicity does not affect atomicity.
<P>
<DD><DL>
<DT><B>Specified by:</B><DD><CODE><A HREF="../../org/mapdb/Engine.html#compareAndSwap(long, A, A, org.mapdb.Serializer)">compareAndSwap</A></CODE> in interface <CODE><A HREF="../../org/mapdb/Engine.html" title="interface in org.mapdb">Engine</A></CODE><DT><B>Overrides:</B><DD><CODE><A HREF="../../org/mapdb/EngineWrapper.html#compareAndSwap(long, A, A, org.mapdb.Serializer)">compareAndSwap</A></CODE> in class <CODE><A HREF="../../org/mapdb/EngineWrapper.html" title="class in org.mapdb">EngineWrapper</A></CODE></DL>
</DD>
<DD><DL>
<DT><B>Parameters:</B><DD><CODE>recid</CODE> - (record identifier) under which record was persisted.<DD><CODE>expectedOldValue</CODE> - old value to be compared with existing record<DD><CODE>newValue</CODE> - to be written if values are matching<DD><CODE>serializer</CODE> - used to serialize record into binary form
<DT><B>Returns:</B><DD>true if values matched and newValue was written</DL>
</DD>
</DL>
<HR>

<A NAME="delete(long, org.mapdb.Serializer)"><!-- --></A><H3>
delete</H3>
<PRE>
public &lt;A&gt; void <B>delete</B>(long&nbsp;recid,
                       <A HREF="../../org/mapdb/Serializer.html" title="interface in org.mapdb">Serializer</A>&lt;A&gt;&nbsp;serializer)</PRE>
<DL>
<DD>Remove existing record from store/cache

 <p/>
 Recid must be a number returned by 'put' method.
 Behaviour for invalid recid (random number or already deleted record)
 is not defined, typically it throws 'EndOfFileException',
 but it may also corrupt store.

  This method places 'tombstone' into Write Queue so record is eventually
  deleted asynchronously. However record is visible as deleted immediately.
<P>
<DD><DL>
<DT><B>Specified by:</B><DD><CODE><A HREF="../../org/mapdb/Engine.html#delete(long, org.mapdb.Serializer)">delete</A></CODE> in interface <CODE><A HREF="../../org/mapdb/Engine.html" title="interface in org.mapdb">Engine</A></CODE><DT><B>Overrides:</B><DD><CODE><A HREF="../../org/mapdb/EngineWrapper.html#delete(long, org.mapdb.Serializer)">delete</A></CODE> in class <CODE><A HREF="../../org/mapdb/EngineWrapper.html" title="class in org.mapdb">EngineWrapper</A></CODE></DL>
</DD>
<DD><DL>
<DT><B>Parameters:</B><DD><CODE>recid</CODE> - (record identifier) under which was record persisted<DD><CODE>serializer</CODE> - which may be used in some circumstances to deserialize and store old object</DL>
</DD>
</DL>
<HR>

<A NAME="close()"><!-- --></A><H3>
close</H3>
<PRE>
public void <B>close</B>()</PRE>
<DL>
<DD>Close store/cache. This method must be called before JVM exits to flush all caches and prevent store corruption.
 Also it releases resources used by MapDB (disk, memory..).
 <p/>
 Engine can no longer be used after this method was called. If Engine is used after closing, it may
 throw any exception including <code>NullPointerException</code>
 </p>
 There is an configuration option <A HREF="../../org/mapdb/DBMaker.html#closeOnJvmShutdown()"><CODE>DBMaker.closeOnJvmShutdown()</CODE></A> which uses shutdown hook to automatically
 close Engine when JVM shutdowns.

  This method blocks until Write Queue is flushed and Writer Thread writes all records and finishes.
  When this method was called `closeInProgress` is set and no record can be modified.
<P>
<DD><DL>
<DT><B>Specified by:</B><DD><CODE><A HREF="../../org/mapdb/Engine.html#close()">close</A></CODE> in interface <CODE><A HREF="../../org/mapdb/Engine.html" title="interface in org.mapdb">Engine</A></CODE><DT><B>Overrides:</B><DD><CODE><A HREF="../../org/mapdb/EngineWrapper.html#close()">close</A></CODE> in class <CODE><A HREF="../../org/mapdb/EngineWrapper.html" title="class in org.mapdb">EngineWrapper</A></CODE></DL>
</DD>
<DD><DL>
</DL>
</DD>
</DL>
<HR>

<A NAME="waitForAction(int)"><!-- --></A><H3>
waitForAction</H3>
<PRE>
protected void <B>waitForAction</B>(int&nbsp;actionNumber)</PRE>
<DL>
<DD><DL>
</DL>
</DD>
<DD><DL>
</DL>
</DD>
</DL>
<HR>

<A NAME="commit()"><!-- --></A><H3>
commit</H3>
<PRE>
public void <B>commit</B>()</PRE>
<DL>
<DD>Makes all changes made since the previous commit/rollback permanent.
 In transactional mode (on by default) it means creating journal file and replaying it to storage.
 In other modes it may flush disk caches or do nothing at all (check your config options)

  This method blocks until Write Queue is flushed.
  All put/update/delete methods are blocked while commit is in progress (via global ReadWrite Commit Lock).
  After this method returns, commit lock is released and other operations may continue
<P>
<DD><DL>
<DT><B>Specified by:</B><DD><CODE><A HREF="../../org/mapdb/Engine.html#commit()">commit</A></CODE> in interface <CODE><A HREF="../../org/mapdb/Engine.html" title="interface in org.mapdb">Engine</A></CODE><DT><B>Overrides:</B><DD><CODE><A HREF="../../org/mapdb/EngineWrapper.html#commit()">commit</A></CODE> in class <CODE><A HREF="../../org/mapdb/EngineWrapper.html" title="class in org.mapdb">EngineWrapper</A></CODE></DL>
</DD>
<DD><DL>
</DL>
</DD>
</DL>
<HR>

<A NAME="rollback()"><!-- --></A><H3>
rollback</H3>
<PRE>
public void <B>rollback</B>()</PRE>
<DL>
<DD>Undoes all changes made in the current transaction.
 If transactions are disabled it throws <A HREF="http://java.sun.com/javase/6/docs/api/java/lang/UnsupportedOperationException.html?is-external=true" title="class or interface in java.lang"><CODE>UnsupportedOperationException</CODE></A>.

  This method blocks until Write Queue is cleared.
  All put/update/delete methods are blocked while rollback is in progress (via global ReadWrite Commit Lock).
  After this method returns, commit lock is released and other operations may continue
<P>
<DD><DL>
<DT><B>Specified by:</B><DD><CODE><A HREF="../../org/mapdb/Engine.html#rollback()">rollback</A></CODE> in interface <CODE><A HREF="../../org/mapdb/Engine.html" title="interface in org.mapdb">Engine</A></CODE><DT><B>Overrides:</B><DD><CODE><A HREF="../../org/mapdb/EngineWrapper.html#rollback()">rollback</A></CODE> in class <CODE><A HREF="../../org/mapdb/EngineWrapper.html" title="class in org.mapdb">EngineWrapper</A></CODE></DL>
</DD>
<DD><DL>
</DL>
</DD>
</DL>
<HR>

<A NAME="compact()"><!-- --></A><H3>
compact</H3>
<PRE>
public void <B>compact</B>()</PRE>
<DL>
<DD>

 This method blocks all put/update/delete operations until it finishes (via global ReadWrite Commit Lock).
<P>
<DD><DL>
<DT><B>Specified by:</B><DD><CODE><A HREF="../../org/mapdb/Engine.html#compact()">compact</A></CODE> in interface <CODE><A HREF="../../org/mapdb/Engine.html" title="interface in org.mapdb">Engine</A></CODE><DT><B>Overrides:</B><DD><CODE><A HREF="../../org/mapdb/EngineWrapper.html#compact()">compact</A></CODE> in class <CODE><A HREF="../../org/mapdb/EngineWrapper.html" title="class in org.mapdb">EngineWrapper</A></CODE></DL>
</DD>
<DD><DL>
</DL>
</DD>
</DL>
<HR>

<A NAME="clearCache()"><!-- --></A><H3>
clearCache</H3>
<PRE>
public void <B>clearCache</B>()</PRE>
<DL>
<DD>clears any underlying cache

  This method blocks until Write Queue is empty (written into disk).
  It also blocks any put/update/delete operations until it finishes (via global ReadWrite Commit Lock).
<P>
<DD><DL>
<DT><B>Specified by:</B><DD><CODE><A HREF="../../org/mapdb/Engine.html#clearCache()">clearCache</A></CODE> in interface <CODE><A HREF="../../org/mapdb/Engine.html" title="interface in org.mapdb">Engine</A></CODE><DT><B>Overrides:</B><DD><CODE><A HREF="../../org/mapdb/EngineWrapper.html#clearCache()">clearCache</A></CODE> in class <CODE><A HREF="../../org/mapdb/EngineWrapper.html" title="class in org.mapdb">EngineWrapper</A></CODE></DL>
</DD>
<DD><DL>
</DL>
</DD>
</DL>
<!-- ========= END OF CLASS DATA ========= -->
<HR>


<!-- ======= START OF BOTTOM NAVBAR ====== -->
<A NAME="navbar_bottom"><!-- --></A>
<A HREF="#skip-navbar_bottom" title="Skip navigation links"></A>
<TABLE BORDER="0" WIDTH="100%" CELLPADDING="1" CELLSPACING="0" SUMMARY="">
<TR>
<TD COLSPAN=2 BGCOLOR="#EEEEFF" CLASS="NavBarCell1">
<A NAME="navbar_bottom_firstrow"><!-- --></A>
<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="3" SUMMARY="">
  <TR ALIGN="center" VALIGN="top">
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../org/mapdb/package-summary.html"><FONT CLASS="NavBarFont1"><B>Package</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#FFFFFF" CLASS="NavBarCell1Rev"> &nbsp;<FONT CLASS="NavBarFont1Rev"><B>Class</B></FONT>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="class-use/AsyncWriteEngine.html"><FONT CLASS="NavBarFont1"><B>Use</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-tree.html"><FONT CLASS="NavBarFont1"><B>Tree</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../deprecated-list.html"><FONT CLASS="NavBarFont1"><B>Deprecated</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../index-all.html"><FONT CLASS="NavBarFont1"><B>Index</B></FONT></A>&nbsp;</TD>
  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../help-doc.html"><FONT CLASS="NavBarFont1"><B>Help</B></FONT></A>&nbsp;</TD>
  </TR>
</TABLE>
</TD>
<TD ALIGN="right" VALIGN="top" ROWSPAN=3><EM>
</EM>
</TD>
</TR>

<TR>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
&nbsp;PREV CLASS&nbsp;
&nbsp;<A HREF="../../org/mapdb/AsyncWriteEngine.WriterRunnable.html" title="class in org.mapdb"><B>NEXT CLASS</B></A></FONT></TD>
<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
  <A HREF="../../index.html?org/mapdb/AsyncWriteEngine.html" target="_top"><B>FRAMES</B></A>  &nbsp;
&nbsp;<A HREF="AsyncWriteEngine.html" target="_top"><B>NO FRAMES</B></A>  &nbsp;
&nbsp;<SCRIPT type="text/javascript">
  <!--
  if(window==top) {
    document.writeln('<A HREF="../../allclasses-noframe.html"><B>All Classes</B></A>');
  }
  //-->
</SCRIPT>
<NOSCRIPT>
  <A HREF="../../allclasses-noframe.html"><B>All Classes</B></A>
</NOSCRIPT>


</FONT></TD>
</TR>
<TR>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
  SUMMARY:&nbsp;<A HREF="#nested_class_summary">NESTED</A>&nbsp;|&nbsp;<A HREF="#field_summary">FIELD</A>&nbsp;|&nbsp;<A HREF="#constructor_summary">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_summary">METHOD</A></FONT></TD>
<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
DETAIL:&nbsp;<A HREF="#field_detail">FIELD</A>&nbsp;|&nbsp;<A HREF="#constructor_detail">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_detail">METHOD</A></FONT></TD>
</TR>
</TABLE>
<A NAME="skip-navbar_bottom"></A>
<!-- ======== END OF BOTTOM NAVBAR ======= -->

<HR>
Copyright &#169; 2014. All Rights Reserved.
</BODY>
</HTML>
