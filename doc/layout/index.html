<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Collection Layout &mdash; MapDB</title>
    
    <link rel="stylesheet" href="../../_static/sphinx13.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="MapDB" href="../../" />
    <link rel="up" title="MapDB Manual" href="../" />
    <link rel="next" title="Storage format" href="../format/" />
    <link rel="prev" title="Sorted Table Map" href="../sortedtablemap/" />
  
 
    <style type="text/css">
      table.right { float: right; margin-left: 20px; }
      table.right td { border: 1px solid #ccc; }
      
    </style>
    <script type="text/javascript">
      // intelligent scrolling of the sidebar content
      $(window).scroll(function() {
        var sb = $('.sphinxsidebarwrapper');
        var win = $(window);
        var sbh = sb.height();
        var offset = $('.sphinxsidebar').position()['top'];
        var wintop = win.scrollTop();
        var winbot = wintop + win.innerHeight();
        var curtop = sb.position()['top'];
        var curbot = curtop + sbh;
        // does sidebar fit in window?
        if (sbh < win.innerHeight()) {
          // yes: easy case -- always keep at the top
          sb.css('top', $u.min([$u.max([0, wintop - offset - 10]),
                                $(document).height() - sbh - 200]));
        } else {
          // no: only scroll if top/bottom edge of sidebar is at
          // top/bottom edge of window
          if (curtop > wintop && curbot > winbot) {
            sb.css('top', $u.max([wintop - offset - 10, 0]));
          } else if (curtop < wintop && curbot < winbot) {
            sb.css('top', $u.min([winbot - sbh - offset - 20,
                                  $(document).height() - sbh - 200]));
          }
        }
      });
    </script>

<!-- google analytics-->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-42074659-1', 'auto');
  ga('send', 'pageview');

</script>

  
  <link rel="alternate" type="application/atom+xml"  href="../../blog/atom.xml" title="MapDB Blog">
  
  
  <style type="text/css">
    ul.ablog-archive {list-style: none; overflow: auto; margin-left: 0px}
    ul.ablog-archive li {float: left; margin-right: 5px; font-size: 80%}
    ul.postlist a {font-style: italic;}
    ul.postlist-style-disc {list-style-type: disc;}
    ul.postlist-style-none {list-style-type: none;}
    ul.postlist-style-circle {list-style-type: circle;}
  </style>

  </head>
  <body role="document">
<div class="pageheader">
  <ul>
    <li><a href="../../">Home</a></li>
    <li><a href="../quick-start/">Quick start</a></li>
    <li><a href="../">Docs</a></li>
    <li><a href="../../blog/">Blog</a></li>
      <li><a href="../../support/">Support</a></li>

      <li><a href="https://github.com/jankotek/mapdb">Github</a></li>
  </ul>
  <div>
    <a href="../../">
      <img src="../../_static/logo.png" alt="MapDB" />
    </a>
  </div>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../format/" title="Storage format"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="../sortedtablemap/" title="Sorted Table Map"
             accesskey="P">previous</a> |</li>
        <li><a href="../../">Home</a>&nbsp;|</li>

          <li class="nav-item nav-item-1"><a href="../" accesskey="U">MapDB Manual</a> &raquo;</li> 
      </ul>
    </div>
<div class="sphinxsidebar" role="navigation" aria-label="main navigation">
    <div class="sphinxsidebarwrapper">
  <h3><a href="../../">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Collection Layout</a><ul>
<li><a class="reference internal" href="#hash-partitioning">Hash Partitioning</a></li>
<li><a class="reference internal" href="#range-partitioning">Range partitioning</a></li>
<li><a class="reference internal" href="#time-of-update-partitioning">Time of Update Partitioning</a><ul>
<li><a class="reference internal" href="#partitioning-by-durability">Partitioning by Durability</a></li>
<li><a class="reference internal" href="#name">Name?</a></li>
<li><a class="reference internal" href="#expiration-partitioning">Expiration Partitioning</a></li>
</ul>
</li>
</ul>
</li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search/" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script><div class="sitemap">
    <h3>Site Map</h3>
    <ul>
        <li><a href="/support/">Support</a><ul>
            <li><a href="/support/#free-discovery-call">Free discovery call</a></li>
            <li><a href="/support/#consulting-services">Consulting services</a></li>
        </ul></li>
        <li><a href="/blog/">Blog</a></li>
        <li><a href="/success/">Who is using MapDB</a></li>
        <li><a href="/benchmarks/">Benchmarks</a></li>
        <li><a href="/changelog/">Changelog</a></li>
        <li><a href="/credits/">Credits</a></li>

        <li><a href="/doc/">Documentation</a><ul>
            <li><a href="/doc/intro/">Intro</a></li>
            <li><a href="/doc/quick-start/">Quick start</a></li>
            <li><a href="/doc/db/">DB and DBMaker</a></li>
            <li><a href="/doc/htreemap/">HTreeMap</a></li>
            <li><a href="/doc/btreemap/">BTreeMap</a></li>
            <li><a href="/doc/sortedtablemap/">Sorted Table Map</a></li>
        </ul></li>
    </ul>

    <h3>Links</h3>
    <ul>
        <li><a href="https://www.github.com/jankotek/mapdb/">Github</a>
        <li><a href="https://www.github.com/jankotek/mapdb/issues/">Issue tracker</a>
        <li><a href="https://groups.google.com/forum/#!forum/mapdb">Mail list</a></li>
        <li><a href="https://www.reddit.com/r/mapdb">Reddit forum</a></li>
        <li><a href="https://gitter.im/jankotek/mapdb">Gitter chat</a></li>
    </ul>
</div>
    </div>
</div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="collection-layout">
<h1>Collection Layout<a class="headerlink" href="#collection-layout" title="Permalink to this headline">¶</a></h1>
<p>Partitioning in databases is usually way to distribute data between multiple stores, tables etc...
MapDB has great flexibility and its partitioning is more complicated.
So in MapDB partitioning is when collection is using more than single Store, to contain its state.</p>
<p>For example <code class="docutils literal"><span class="pre">HTreeMap</span></code> can split key-value entries between multiple disks, while its Hash Table uses in-memory Store
and Expiration Queues are regular on-heap collections.</p>
<p>This chapter gives overview of most partitioning options in MapDB. Details are in separate chapters for each
collection or Store.</p>
<div class="section" id="hash-partitioning">
<h2>Hash Partitioning<a class="headerlink" href="#hash-partitioning" title="Permalink to this headline">¶</a></h2>
<p>HP is well supported in HTreeMap <em>TODO link</em>. To achieve concurrency HashMap is split into
segments, each segment is separate HashMap with its own ReadWriteLock. Segment number is calculated from hash.
When expiration is enabled each segment has its own Expiration Queue.</p>
<p>Usually HTreeMap segments share single Store <em>TODO link</em>. But each segment can have its own Store, that improves
concurrency and allows to shard HTreeMap across multiple disks.</p>
</div>
<div class="section" id="range-partitioning">
<h2>Range partitioning<a class="headerlink" href="#range-partitioning" title="Permalink to this headline">¶</a></h2>
<p>Is not currently supported in BTreeMap.</p>
<p><em>TODO discus sharding based on Node Recid hash</em></p>
<p><em>TODO investigate feasibility in BTreeMap</em></p>
</div>
<div class="section" id="time-of-update-partitioning">
<h2>Time of Update Partitioning<a class="headerlink" href="#time-of-update-partitioning" title="Permalink to this headline">¶</a></h2>
<p>Large BTrees usually has slow updates, due to write amplification <em>TODO chapter &amp; link</em>.
In some cases (time series) it makes sense to shard data based on last modification.
Each day (or other interval) has its own store, old data can be removed just by deleting files.
There are various options to handle modifications, delete markers etc...
MapDB supports this with SortedTableMap and CopyOnWriteMap</p>
<p><em>TODO this could also work on HTreeMap (sorted by hash)</em></p>
<div class="section" id="partitioning-by-durability">
<h3>Partitioning by Durability<a class="headerlink" href="#partitioning-by-durability" title="Permalink to this headline">¶</a></h3>
<p>Durable commits are much slower than non-durable. We have to move data to/from write-ahead-log, sync files,
calculate checksums... Durability Partitioning allows to minimize size of durable data, by moving non essential
data into non-durable store. Trade off is longer recovery time after crash.</p>
<p>Good example is BTree. We really only care about Leaf Nodes, which contains all key-value pairs. Directory nodes (index)
can be easily reconstructed from Leaf Nodes. BTreeMap can use two stores, one with durable commits for leafs,
second non-durable for directory nodes. Pump than reconstructs Directory Store in case of crash.</p>
</div>
<div class="section" id="name">
<h3>Name?<a class="headerlink" href="#name" title="Permalink to this headline">¶</a></h3>
<p><em>TODO HTreeMap expiration queues onheap, in memory</em></p>
<p><em>TODO in-memory indexes for HTreeMap and BTreeMap</em></p>
<p><em>TODO HTreeMap IndexTree onheap</em></p>
</div>
<div class="section" id="expiration-partitioning">
<h3>Expiration Partitioning<a class="headerlink" href="#expiration-partitioning" title="Permalink to this headline">¶</a></h3>
<p><em>TODO HTreeMap disk overflow</em></p>
</div>
</div>
</div>

  <div class="section">
  
  
  </div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../format/" title="Storage format"
             >next</a></li>
        <li class="right" >
          <a href="../sortedtablemap/" title="Sorted Table Map"
             >previous</a> |</li>
        <li><a href="../../">Home</a>&nbsp;|</li>

          <li class="nav-item nav-item-1"><a href="../" >MapDB Manual</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2016, jan.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.6.
    </div>
  </body>
</html>