<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Transactions &mdash; MapDB</title>
    
    <link rel="stylesheet" href="../_static/sphinx13.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="MapDB" href="../index.html" />
    <link rel="up" title="MapDB Manual" href="index.html" />
    <link rel="next" title="MapDB internals" href="internals.html" />
    <link rel="prev" title="Secondary Collections" href="secondary-collections.html" />
  
 
    <style type="text/css">
      table.right { float: right; margin-left: 20px; }
      table.right td { border: 1px solid #ccc; }
      
    </style>
    <script type="text/javascript">
      // intelligent scrolling of the sidebar content
      $(window).scroll(function() {
        var sb = $('.sphinxsidebarwrapper');
        var win = $(window);
        var sbh = sb.height();
        var offset = $('.sphinxsidebar').position()['top'];
        var wintop = win.scrollTop();
        var winbot = wintop + win.innerHeight();
        var curtop = sb.position()['top'];
        var curbot = curtop + sbh;
        // does sidebar fit in window?
        if (sbh < win.innerHeight()) {
          // yes: easy case -- always keep at the top
          sb.css('top', $u.min([$u.max([0, wintop - offset - 10]),
                                $(document).height() - sbh - 200]));
        } else {
          // no: only scroll if top/bottom edge of sidebar is at
          // top/bottom edge of window
          if (curtop > wintop && curbot > winbot) {
            sb.css('top', $u.max([wintop - offset - 10, 0]));
          } else if (curtop < wintop && curbot < winbot) {
            sb.css('top', $u.min([winbot - sbh - offset - 20,
                                  $(document).height() - sbh - 200]));
          }
        }
      });
    </script>

<!-- google analytics-->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-42074659-1', 'auto');
  ga('send', 'pageview');

</script>

  
  
  <style type="text/css">
    ul.ablog-archive {list-style: none; overflow: auto; margin-left: 0px}
    ul.ablog-archive li {float: left; margin-right: 5px; font-size: 80%}
    ul.post-list-style-disc {list-style-type: disc;}
    ul.post-list-style-none {list-style-type: none;}
    ul.post-list-style-circle {list-style-type: circle;}
  </style>

  </head>
  <body role="document">
<div class="pageheader">
  <ul>
    <li><a href="../index.html">Home</a></li>
    <li><a href="getting-started.html">Intro</a></li>
    <li><a href="index.html">Docs</a></li>
    <li><a href="/blog.html">Blog</a></li>
    <li><a href="https://github.com/jankotek/mapdb">Github</a></li>
  </ul>
  <div>
    <a href="../index.html">
      <img src="../_static/logo.png" alt="MapDB" />
    </a>
  </div>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="internals.html" title="MapDB internals"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="secondary-collections.html" title="Secondary Collections"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Home</a>&nbsp;|</li>
        <li><a href="../contents.html">Documentation</a> &raquo;</li>

          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">MapDB Manual</a> &raquo;</li> 
      </ul>
    </div>
    <div class="document">
    <div class="documentwrapper">
        <div class="bodywrapper">
            <div class="body" role="main">
                
  <div class="section" id="transactions">
<h1>Transactions<a class="headerlink" href="#transactions" title="Permalink to this headline">¶</a></h1>
<p>Transactions in MapDB are considered a heavyweight option. Often you can
get a similar result using atomic updates in
<a class="reference external" href="http://docs.oracle.com/javase/7/docs/api/java/util/concurrent/ConcurrentMap.html">ConcurrentMap</a>
and <a class="reference external" href="http://www.mapdb.org/apidocs/org/mapdb/Atomic.html">Atomic
variables</a></p>
<p>On the other hand transactions are not just for concurrent updates, but they can also protect the store from corruption.
MapDB has two ways to handle rollback: Write-Ahead-Log and Append-Only-Log files.</p>
<p>MapDB comes with several transactions options. From ultra-fast direct
mode to concurrent transactions with MVCC snapshots and serializable
conflict resolution.</p>
<p>There are three transactional modes:</p>
<div class="section" id="transactions-disables-aka-direct-mode">
<h2>Transactions disables (aka direct mode)<a class="headerlink" href="#transactions-disables-aka-direct-mode" title="Permalink to this headline">¶</a></h2>
<p>In this mode transactions and all safety options are disabled to achieve
best write performance. Changes are written directly to underlying
files.</p>
<p>This mode has zero crash protection. If you do not close your database
correctly, your data are gone. You may also call <code class="docutils literal"><span class="pre">db.commit()</span></code> to
flush and sync all changes into underlying files.</p>
<p>This mode is generally recommended for cases where data can be
reconstructed easily. For example initial imports, caches etc.</p>
<p>An example how to enable this mode:</p>
<div class="code java highlight-python"><div class="highlight"><pre>DB db = DBMaker.newMemoryDB()
    .transactionsDisable()
    .make();
</pre></div>
</div>
</div>
<div class="section" id="single-global-transaction">
<h2>Single global transaction<a class="headerlink" href="#single-global-transaction" title="Permalink to this headline">¶</a></h2>
<p>This mode is the default option. In this case DB has a single global
transaction. It is very simple to use, since the user does not have to handle
concurrent write conflicts and rollback. In this case the store is
protected by Write-Ahead-Log.</p>
<div class="code java highlight-python"><div class="highlight"><pre>DB db = DBMaker.newMemoryDB()
    .make()
</pre></div>
</div>
</div>
<div class="section" id="concurrent-transactions">
<h2>Concurrent transactions<a class="headerlink" href="#concurrent-transactions" title="Permalink to this headline">¶</a></h2>
<p>In this case the user has multiple transactions. Each has its own snapshots
with serializable isolation and optimistic locking. It offers the strongest
consistency possible. Any changes are held in memory. On commit MapDB checks
for conflicts and commits or throws <code class="docutils literal"><span class="pre">TxRollbackException</span></code> and rollback
changes.</p>
<div class="code java highlight-python"><div class="highlight"><pre>    //Open Transaction Factory. DBMaker shares most options with single-transaction mode.
        TxMaker txMaker = DBMaker
                .newMemoryDB()
                .makeTxMaker();

        // Now open first transaction and get map from first transaction
        DB tx1 = txMaker.makeTx();

        //create map from first transactions and fill it with data
        Map map1 = tx1.getTreeMap(&quot;testMap&quot;);
        for(int i=0;i&lt;1e4;i++){
            map1.put(i,&quot;aaa&quot;+i);
        }

        //commit first transaction
        tx1.commit();

        // !! IMPORTANT !!
        // !! DB transaction can be used only once,
        // !! it throws an &#39;already closed&#39; exception after it was commited/rolledback
        // !! IMPORTANT !!
        //map1.put(1111,&quot;dqdqwd&quot;); // this will fail

        //open second transaction
        DB tx2 = txMaker.makeTx();
        Map map2 = tx2.getTreeMap(&quot;testMap&quot;);

        //open third transaction
        DB tx3 = txMaker.makeTx();
        Map map3 = tx3.getTreeMap(&quot;testMap&quot;);
//TODO more from tx example
</pre></div>
</div>
</div>
</div>

  <div class="section">
  
  
  </div>


                <script>

if(window.location.href.indexOf('/blog/')>-1){

document.write('<br><br><br><hr><br><div id="disqus_thread"></div>');


/**
* RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
* LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
*/
/*
var disqus_config = function () {
this.page.url = 'http://www.mapdb.org'; // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = 'mapdb'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');

s.src = '//mapdb.disqus.com/embed.js';

s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();

}
</script>

            </div>
        </div>
    </div>

    <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="internals.html" title="MapDB internals"
             >next</a> |</li>
        <li class="right" >
          <a href="secondary-collections.html" title="Secondary Collections"
             >previous</a> |</li>
        <li><a href="../index.html">Home</a>&nbsp;|</li>
        <li><a href="../contents.html">Documentation</a> &raquo;</li>

          <li class="nav-item nav-item-1"><a href="index.html" >MapDB Manual</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2014, Jan Kotek.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>