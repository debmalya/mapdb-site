
<!DOCTYPE html>
<!--
 Generated by Apache Maven Doxia at 2014-07-19
 Rendered using Maven Reflow Skin 1.0.0 (http://andriusvelykis.github.com/reflow-maven-skin)
-->
<html  xml:lang="en" lang="en">

	<head>
		<meta charset="UTF-8" />
		<title>`DBMaker and DB | mapdb</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="description" content="" />
		<meta http-equiv="content-language" content="en" />
 
		<link href="http://netdna.bootstrapcdn.com/bootswatch/2.2.2/spruce/bootstrap.min.css" rel="stylesheet" />
		<link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.2/css/bootstrap-responsive.min.css" rel="stylesheet" />
		<link href="http://andriusvelykis.github.com/reflow-maven-skin//css/bootswatch.css" rel="stylesheet" />
		<link href="http://andriusvelykis.github.com/reflow-maven-skin//css/reflow-skin.css" rel="stylesheet" />
		
		<link href="http://yandex.st/highlightjs/7.3/styles/github.min.css" rel="stylesheet" />
		
		<link href="http://andriusvelykis.github.com/reflow-maven-skin//css/lightbox.css" rel="stylesheet" />
		
		<link href="http://andriusvelykis.github.com/reflow-maven-skin//css/site.css" rel="stylesheet" />
		<link href="http://andriusvelykis.github.com/reflow-maven-skin//css/print.css" rel="stylesheet" media="print" />
		
		<!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
		<!--[if lt IE 9]>
			<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->
		
<style type="text/css">body,h1,h2,h3,h4,h5,h6,code,pre,input,button,select,textarea,.navbar-search,.navbar-search .search-query,h1 small,h2 small,h3 small,h4 small,h5 small,h6 small,.muted,.navbar .brand,.navbar .brand:hover,.navbar .nav li a,.navbar .navbar-text,.navbar .dropdown-menu li a, div.subnav, div.subnav .nav li a,.btn,legend,.alert-heading{
                font-family:Arial, sans-serif;
                }

                @media (max-width:979px){.navbar .nav-collapse .nav li a .navbar .nav-collapse .nav li a:hover, .navbar-inverse .nav-collapse .nav li a:hover, .nav-collapse .navbar-form,.nav-collapse .navbar-search}{
                font-family:Arial, sans-serif;
                }</style>
		<!-- Google Analytics -->
		<script type="text/javascript">
		
			var _gaq = _gaq || [];
			_gaq.push(['_setAccount', 'UA-42074659-1']);
			_gaq.push(['_trackPageview']);

			(function() {
				var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
				ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
				var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
			})();

		</script>
		</head>

	<body class="page-10-db-and-dbmaker project-mapdb-site" data-spy="scroll" data-offset="60" data-target="#toc-scroll-target">

		<div class="navbar navbar-fixed-top">
			<div class="navbar-inner">
				<div class="container">
					<a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</a>
					<a class="brand" href="./"><img src="images/logo.png" border="0" alt="MapDB"/> - java beyond heap</a>
					<div class="nav-collapse">
						<ul class="nav pull-right">
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">MapDB <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li><a href="index.html" title="Index">Index </a></li>
									<li><a href="http://www.github.com/jankotek/mapdb" title="Github" class="externalLink">Github </a></li>
									<li><a href="features.html" title="Features">Features </a></li>
									<li><a href="changelog.html" title="Changelog">Changelog </a></li>
									<li><a href="credits.html" title="Credits">Credits </a></li>
								</ul>
							</li>
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">FAQ <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li><a href="faq-general.html" title="General">General </a></li>
									<li><a href="faq-problems.html" title="Problems">Problems </a></li>
									<li><a href="faq-performance.html" title="Performance">Performance </a></li>
								</ul>
							</li>
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Documentation <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li><a href="02-getting-started.html" title="Getting started">Getting started </a></li>
									<li><a href="http://www.youtube.com/watch?v=FdZmyEHcWLI" title="Overview Video" class="externalLink">Overview Video </a></li>
									<li><a href="https://github.com/jankotek/MapDB/tree/master/src/test/java/examples" title="Examples" class="externalLink">Examples </a></li>
									<li><a href="apidocs/index.html" title="JavaDoc">JavaDoc </a></li>
									<li><a href="doc/cheatsheet.pdf" title="Cheat Sheet">Cheat Sheet </a></li>
								</ul>
							</li>
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown">Support <b class="caret"></b></a>
								<ul class="dropdown-menu">
									<li><a href="http://groups.google.com/group/mapdb" title="Mail list" class="externalLink">Mail list </a></li>
									<li><a href="https://github.com/jankotek/MapDB/issues" title="Bug tracker" class="externalLink">Bug tracker </a></li>
								</ul>
							</li>
						</ul>
					</div><!--/.nav-collapse -->
				</div>
			</div>
		</div>
		
	<div class="container">
	
	<!-- Masthead
	================================================== -->
		<hr class="toc-separator" />
		<div id="toc-bar" class="navbar">
			<div class="navbar-inner">
				<div id="toc-scroll-target" class="container">
					<ul id="toc" class="nav">
						<li class="toplevel"><a href="#dbmaker_and_db" title="`DBMaker and DB">`DBMaker and DB</a></li>
						<li class="toplevel"><a href="#Transactions" title="Transactions">Transactions</a></li>
					</ul>
				</div>
			</div>
		</div>
	</header>

	<div class="main-body">
	<div class="row">
		<div class="span12">
			<div class="body-content">
<div class="page-header">
 <h1 id="dbmaker_and_db">`DBMaker and DB</h1>
</div> 
<p>MapDB is set of loosely coupled components. One could wire classes such as <tt>CacheMRU</tt>, <tt>StoreWAL</tt> and <tt>BTreeMap</tt> manually, byt there are two factory classes to do it for you: <tt>DBMaker</tt> and <tt>DB</tt>. They use maker (builder) pattern, so most configuration options are quickly available via code assistant in IDE. </p> 
<p><a href="apidocs/org/mapdb/DBMaker.html">DBMaker</a> handles database configuration, creation and opening. MapDB has several modes and configuration options. Most of those can be set using this class.</p> 
<p><a href="apidocs/org/mapdb/DB.html">DB</a> represents opened database (or single transaction session). It creates and opens collections . It also handles transaction with methods such as <tt>commit()</tt>, <tt>rollback()</tt> and <tt>close()</tt>.</p> 
<p>To open (or create) store use one of <tt>DBMaker.newXXX()</tt> static methods. MapDB has more formats and modes, each <tt>newXXX()</tt> uses different: <tt>newMemoryDB()</tt> opens in-memory database backed by <tt>byte[]</tt>, <tt>newAppendFileDB()</tt> opens db which uses append-only log files and so on. </p> 
<p><tt>newXXX()</tt> method is followed by configuration options and <tt>make()</tt> method which applyes all options and returns <tt>DB</tt> object. This example opens file storage with encryption enabled:</p> 
<div class="source"> 
 <pre>  DB db = DBMaker
    .newAppendFileDB(new File(&quot;/some/file&quot;))
    .encryptionEnable(&quot;password&quot;)
    .make();
</pre> 
</div> 
<p>Once you have DB you may open collection or other record. DB has two types of factory methods: </p> 
<p><tt>getXXX()</tt> opens existing collection (or record). If collection with given name does not exist, it is silently created with default settings and returned. An example:</p> 
<div class="source"> 
 <pre>  NavigableSet treeSet = db.getTreeSet(&quot;treeSet&quot;);
</pre> 
</div> 
<p><tt>createXXX()</tt> creates new collection (or settings) with customized settings. Specialized serializers, node size, entry compression and so on affect performance a lot and they are customizable here.</p> 
<div class="source"> 
 <pre>  Atomic.Var&lt;Person&gt; var = = db.createAtomicVar(&quot;mainPerson&quot;, Person.SERIALIZER);
</pre> 
</div> 
<p>Some <tt>create</tt> method may use builder style configuration. In that case you may finish with two methods: <tt>make()</tt> creates new collection, if collection with given name already exists it throws an exception. <tt>makerOrGet()</tt> is same, except if collection already exist it does not fail, but returns existing collection. </p> 
<div class="source"> 
 <pre>  NavigableSet&lt;String&gt; treeSet = db.createTreeSet(&quot;treeSet);
    .nodeSize(112)
    .serializer(BTreeKeySerializer.STRING) 
    .makeOrGet();
</pre> 
</div> 
<div class="section"> 
 <h2 id="Transactions">Transactions</h2> 
 <p><tt>DB</tt> has methods to handle transaction lifecycle: <tt>commit()</tt>, <tt>rollback()</tt> and <tt>close()</tt>.</p> 
 <div class="source"> 
  <pre>  ConcurrentNavigableMap&lt;Integer,String&gt; map = db.getTreeMap(&quot;collectionName&quot;);

  map.put(1,&quot;one&quot;);
  map.put(2,&quot;two&quot;);
  //map.keySet() is now [1,2] even before commit

  db.commit();  //persist changes into disk

  map.put(3,&quot;three&quot;);
  //map.keySet() is now [1,2,3]
  db.rollback(); //revert recent changes
  //map.keySet() is now [1,2]

  db.close();
</pre> 
 </div> 
 <p>One <tt>DB</tt> object represents single transactions. Examples above use single global transaction, which is sufficient for some usages. MapDB support concurrent transactions as well with full serializable isolation, optimistic locking and MVCC snapshots. In that case we need one extra factory which creates transactions: <tt>TxMaker</tt>. We use <tt>DBMaker</tt> to create it, but instead of <tt>make()</tt> we call <tt>makeTxMaker()</tt></p> 
 <div class="source"> 
  <pre>  TxMaker txMaker = DBMaker
    .newMemoryDB()
    .makeTxMaker();
</pre> 
 </div> 
 <p>And <tt>TxMaker</tt> is than used to create multiple <tt>DB</tt> objects, each representing single transaction:</p> 
 <p>```java DB tx0 = txMaker.makeTx(); Map map0 = tx0.getTreeMap(“testMap”); map0.put(0,“zero”);</p> 
 <p>DB tx1 = txMaker.makeTx(); Map map1 = tx1.getTreeMap(“testMap”);</p> 
 <p>DB tx2 = txMaker.makeTx(); Map map2 = tx1.getTreeMap(“testMap”);</p> 
 <p>map1.put(1,“one”); map2.put(2,“two”);</p> 
 <p>//each map sees only its modifications, //map1.keySet() contains [0,1] //map2.keySet() contains [0,2]</p> 
 <p>//persist changes tx1.commit(); tx2.commit();<br /> // second commit fails with write conflict, both maps share single BTree node, // this does not happend on large maps with sufficent number of BTree nodes. </p> 
</div>
			</div>
		</div>
	</div>
	</div>

	</div><!-- /container -->
	
	<!-- Footer
	================================================== -->
	<footer class="well">
		<div class="container">
			<div class="row">
				<div class="span2 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">MapDB</li>
						<li>
							<a href="index.html" title="Index">Index </a>
						</li>
						<li>
							<a href="http://www.github.com/jankotek/mapdb" title="Github" class="externalLink">Github </a>
						</li>
						<li>
							<a href="features.html" title="Features">Features </a>
						</li>
						<li>
							<a href="changelog.html" title="Changelog">Changelog </a>
						</li>
						<li>
							<a href="credits.html" title="Credits">Credits </a>
						</li>
					</ul>
				</div>
				<div class="span2 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">FAQ</li>
						<li>
							<a href="faq-general.html" title="General">General </a>
						</li>
						<li>
							<a href="faq-problems.html" title="Problems">Problems </a>
						</li>
						<li>
							<a href="faq-performance.html" title="Performance">Performance </a>
						</li>
					</ul>
				</div>
				<div class="span2 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Documentation</li>
						<li>
							<a href="02-getting-started.html" title="Getting started">Getting started </a>
						</li>
						<li>
							<a href="http://www.youtube.com/watch?v=FdZmyEHcWLI" title="Overview Video" class="externalLink">Overview Video </a>
						</li>
						<li>
							<a href="https://github.com/jankotek/MapDB/tree/master/src/test/java/examples" title="Examples" class="externalLink">Examples </a>
						</li>
						<li>
							<a href="apidocs/index.html" title="JavaDoc">JavaDoc </a>
						</li>
						<li>
							<a href="doc/cheatsheet.pdf" title="Cheat Sheet">Cheat Sheet </a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-nav">
					<ul class="nav nav-list">
						<li class="nav-header">Support</li>
						<li>
							<a href="http://groups.google.com/group/mapdb" title="Mail list" class="externalLink">Mail list </a>
						</li>
						<li>
							<a href="https://github.com/jankotek/MapDB/issues" title="Bug tracker" class="externalLink">Bug tracker </a>
						</li>
						<li class="nav-header">Author</li>
						<li>
							<a href="http://www.kotek.net/" title="Blog" class="externalLink">Blog </a>
						</li>
						<li>
							<a href="http://www.twitter.com/jankotek" title="Twitter" class="externalLink">Twitter </a>
						</li>
						<li>
							<a href="mailto:jan@kotek.net" title="Email" class="externalLink">Email </a>
						</li>
						<li>
							<a href="http://www.kotek.net" title="About" class="externalLink">About </a>
						</li>
					</ul>
				</div>
				<div class="span3 bottom-description">
					<blockquote><span class="color-highlight">MapDB</span> provides concurrent Maps, Sets and Queues backed by disk storage or off-heap memory.
It is a fast embedded Java database engine with Apache license.
<br/>
<br/>
<form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
<input type="hidden" name="cmd" value="_s-xclick">
<input type="hidden" name="hosted_button_id" value="GT5445K9K6YK4">
<input type="image" src="/images/donate.gif" border="0" name="submit" alt="Donate!">
</form></blockquote>
				</div>
			</div>
		</div>
	</footer>
		
	<div class="container subfooter">
		<div class="row">
			<div class="span12">
				<p class="pull-right"><a href="#">Back to top</a></p>
				<p class="copyright">Copyright &copy;2014. All Rights Reserved.</p>
				<p class="version-date"><span class="projectVersion">Version: 1.1.0-SNAPSHOT. </span><span class="publishDate">Last Published: 2014-07-19. </span></p>
				<p><a href="http://github.com/andriusvelykis/reflow-maven-skin" title="Reflow Maven skin">Reflow Maven skin</a> by <a href="http://andrius.velykis.lt" target="_blank" title="Andrius Velykis">Andrius Velykis</a>.</p>
			</div>
		</div>
	</div>

	<!-- Le javascript
	================================================== -->
	<!-- Placed at the end of the document so the pages load faster -->

	<!-- Fallback jQuery loading from Google CDN:
	     http://stackoverflow.com/questions/1014203/best-way-to-use-googles-hosted-jquery-but-fall-back-to-my-hosted-library-on-go -->
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
	<script type="text/javascript">
		if (typeof jQuery == 'undefined')
		{
			document.write(unescape("%3Cscript src='http://andriusvelykis.github.com/reflow-maven-skin//js/jquery-1.8.3.min.js' type='text/javascript'%3E%3C/script%3E"));
		}
	</script>
	
	<script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.2/js/bootstrap.min.js"></script>
	<script src="http://andriusvelykis.github.com/reflow-maven-skin//js/lightbox.js"></script>
	<script src="http://andriusvelykis.github.com/reflow-maven-skin//js/jquery.smooth-scroll.min.js"></script>
	<!-- back button support for smooth scroll -->
	<script src="http://andriusvelykis.github.com/reflow-maven-skin//js/jquery.ba-bbq.min.js"></script>
	<script src="http://yandex.st/highlightjs/7.3/highlight.min.js"></script>

	<script src="http://andriusvelykis.github.com/reflow-maven-skin//js/reflow-skin.js"></script>
	
	</body>
</html>
